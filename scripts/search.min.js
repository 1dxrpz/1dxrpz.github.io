var searchTab=document.querySelector("#searchTab"),search_bar=document.querySelector(".search_bar"),searchHistory_container=document.querySelector(".searchHistory_container"),shortcut_links_wrapper=document.querySelector(".shortcut_links_wrapper"),searchEngineLogo=document.querySelector(".searchEngineLogo"),clocks=document.querySelector("#clocks"),searchHistory={items:[]},ShortcutLinks=[],searchEngines=document.querySelectorAll(".searchEngine"),searchEngine="",engines={google:{logo:"../images/google_logo.webp",query:"https://www.google.com/search?q="},duckduckgo:{logo:"../images/DuckDuckGo.webp",query:"https://duckduckgo.com/?q="},yandex:{logo:"../images/yandex.webp",query:"https://yandex.ru/search/?text="}};const isValidUrl=e=>{var t;return!!RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i").test(e)};var maxSize=218453.33333333334;function readFile(){if(!this.files||!this.files[0])return;let e=new FileReader,t=this.files[0];e.addEventListener("load",()=>{var r=document.createElement("img");r.onload=function(e){var n=document.createElement("canvas"),a=n.getContext("2d"),c=r.height*r.width/25/maxSize;c=c>=1?c+.5:c<=.2?c+.1:c,n.width=r.width/c,n.height=r.height/c,a.drawImage(r,0,0,n.width,n.height);var s=n.toDataURL(t.type);document.querySelector("body").style.backgroundImage=`url(${s})`,localStorage.setItem("background",s)},r.src=e.result}),e.readAsDataURL(this.files[0])}document.querySelector("#inp").addEventListener("change",readFile),window.onload=()=>{clocks.innerHTML=formatAMPM(new Date),searchTab.focus(),null==localStorage.getItem("ShortcutLinks")?localStorage.setItem("ShortcutLinks",JSON.stringify(ShortcutLinks)):ShortcutLinks=JSON.parse(localStorage.getItem("ShortcutLinks")),null==localStorage.getItem("background")?localStorage.setItem("background","undefined"):"undefined"!=localStorage.getItem("background")&&(document.querySelector("body").style.backgroundImage=`url(${localStorage.getItem("background")})`),null==localStorage.getItem("searchHistory")?localStorage.setItem("searchHistory",JSON.stringify(searchHistory)):searchHistory=JSON.parse(localStorage.getItem("searchHistory")),null==localStorage.getItem("searchEngine")&&localStorage.setItem("searchEngine","google"),searchEngine=localStorage.getItem("searchEngine"),searchEngines.forEach(e=>{e.removeAttribute("selected")}),[...searchEngines].filter(e=>e.value==searchEngine)[0].setAttribute("selected",!0),searchEngineLogo.setAttribute("src",engines[searchEngine].logo),UpdateLinks()};var webpage=!1,ajaxDelay=!1,CurrentSearchInput="",currentAcSelected=-1;function Autocomplete(e){CurrentSearchInput=e.value,currentAcSelected=-1;let t=0!=e.value.trim().length;searchHistory_container.innerHTML="",searchHistory_container.setAttribute("data-visible",t),webpage=isValidUrl(e.value),search_bar.setAttribute("data-webpage",webpage),searchTab.style.paddingRight=webpage?"100px":"0",ajaxDelay=!0,t&&ajaxDelay&&$.ajax({url:`https://dxrpz-common-utils.herokuapp.com/https://suggestqueries.google.com/complete/search?client=firefox&q=${e.value}`,method:"get",success:function(t){JSON.parse(t)[1].forEach(t=>{var r=t.split(e.value)[1];searchHistory_container.innerHTML+=`<div class="search_autocomplete" data-value="${t}" onclick="SelectAutocomplete(this)"
					>${void 0!=r?e.value:""}<span>${void 0!=r?r:t}</span></div>`})},error:function(e,t){console.log(t)}})}function search(e){"Enter"===event.key&&(webpage?window.location.href=e.value.includes("https://")?e.value:"https://"+e.value:window.location.href=`${engines[searchEngine].query}${e.value.split(" ").join("+")}`,searchHistory.items.push(e.value),localStorage.setItem("searchHistory",JSON.stringify(searchHistory)))}function ClearSearchHistory(){searchHistory={items:[]},localStorage.setItem("searchHistory",JSON.stringify(searchHistory))}function ClearBackgroundImage(){localStorage.setItem("background",void 0),window.location.reload()}function SelectAutocomplete(e){searchTab.value=e.getAttribute("data-value"),searchTab.focus()}function AddNewLink(){var e=new URL(prompt("URL"));ShortcutLinks.some(t=>t.link==e.href)||(ShortcutLinks.push({link:e.href,icon:`https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=${e.origin}&size=64`}),localStorage.setItem("ShortcutLinks",JSON.stringify(ShortcutLinks)),UpdateLinks())}function RemoveLink(e){event.preventDefault();var t=ShortcutLinks.indexOf(t=>t.link==e.getAttribute("href"));ShortcutLinks.splice(t,1),localStorage.setItem("ShortcutLinks",JSON.stringify(ShortcutLinks)),UpdateLinks()}function ClearShortcutLinks(){ShortcutLinks=[],localStorage.setItem("ShortcutLinks",JSON.stringify(ShortcutLinks)),UpdateLinks()}function UpdateLinks(){shortcut_links_wrapper.innerHTML="",ShortcutLinks.forEach(e=>{shortcut_links_wrapper.innerHTML+=`<a class="link" href="${e.link}" oncontextmenu="RemoveLink(this)"><img alt="icon" src="${e.icon}" /></a>`})}function ChangeSearchEngine(e){localStorage.setItem("searchEngine",e.value),searchEngine=e.value,searchEngineLogo.setAttribute("src",engines[e.value].logo)}function formatAMPM(e){var t=e.getHours(),r=e.getMinutes(),n=t>=12?"pm":"am";return t%=12,(t=t||12)+":"+(r=r<10?"0"+r:r)+" "+`<span>${n}</span>`}searchTab.addEventListener("keydown",e=>{var t=document.querySelectorAll(".search_autocomplete");38==e.keyCode&&currentAcSelected>-1&&(currentAcSelected=currentAcSelected>-1?currentAcSelected-1:t.length-1),40==e.keyCode&&(currentAcSelected=currentAcSelected<t.length-1?currentAcSelected+1:-1),(40==e.keyCode||38==e.keyCode)&&(e.preventDefault(),t.forEach(e=>{e.setAttribute("data-selected",!1)}),-1!=currentAcSelected?(t[currentAcSelected].setAttribute("data-selected",!0),SelectAutocomplete(t[currentAcSelected])):searchTab.value=CurrentSearchInput)}),setInterval(e=>{clocks.innerHTML=formatAMPM(new Date)},1e3);